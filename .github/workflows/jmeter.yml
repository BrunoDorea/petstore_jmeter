on: [push]
jobs:
  Main:
    runs-on: ubuntu-latest
    steps:
    - name: Create reports directory
      run: mkdir reports
    
    - name: JMeter Test
      uses: QAInsights/PerfAction@v5.6.2
      with:
        test-plan-path: ./petstore_jmeter/script/PetStore.jmx
        args: "-e -o ./reports/html/"
        
    # - name: Upload Results
    #   uses: actions/upload-artifact@v3
    #   with:
    #     name: jmeter-results
    #     path: result.jtl
    #     if-no-files-found: error
    
    - name: Upload HTML Reports
      uses: actions/upload-artifact@v3
      with:
        name: jmeter-html-reports
        path: reports
        if-no-files-found: error
